<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<div class="container">
    <div class="row">
        <div class="col-12">
            <h2 id="hmsg"></h2>
        </div>
    </div>
    <div class="row">
        <div class="col-6">
            <form id="frm" action="" method="post" class="needs-validation"
                style="max-width: 600px; margin: auto; padding: 20px; ">
                <div class="mb-3">
                    <label for="recipeName" class="form-label">Recipe Name:</label>
                    <input type="text" id="recipeName" name="recipeName" value="milkshake" class="form-control"
                        required>
                </div>
                <div class="mb-3">
                    <label for="recipeId" class="form-label">Recipe ID:</label>
                    <input type="hidden" id="txtrecipeId" name="recipeId" value="0" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="cuisineId" class="form-label">Cuisine ID:</label>
                    <select name="cuisineId" id="lstcuisine" class="form-select"></select>
                </div>
                <div class="mb-3">
                    <label for="usersId" class="form-label">Users ID:</label>
                    <select name="usersId" id="lstusers" class="form-select"></select>
                </div>
                <div class="mb-3">
                    <label for="calories" class="form-label">Calories:</label>
                    <input type="number" id="calories" name="calories" value="200" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="dateDrafted" class="form-label">Date Drafted:</label>
                    <input type="date" id="dateDrafted" name="dateDrafted" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="datePublished" class="form-label">Date Published:</label>
                    <input type="date" id="datePublished" name="datePublished" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="dateArchived" class="form-label">Date Archived:</label>
                    <input type="date" id="dateArchived" name="dateArchived" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="recipeStatus" class="form-label">Recipe Status:</label>
                    <input type="text" id="recipeStatus" name="recipeStatus" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
                <button id="btndelete" class="btn btn-danger">Delete</button>
            </form>
        </div>
    </div>
</div>

<script>
    const frm = document.getElementById("frm");
    const txtrecipeid = document.getElementById("txtrecipeId");
    const hmsg = document.getElementById("hmsg");
    document.addEventListener("DOMContentLoaded", () => {
        (async () => {
            const response = await fetch("https://dgrecipeapi.azurewebsites.net/api/cuisine");
            const data = await response.json();
            const lst = document.getElementById("lstcuisine");
            data.forEach(c => {
                const option = document.createElement("option");
                option.value = c.cuisineId;
                option.text = c.cuisineName;
                lst.appendChild(option);
            });
        })();
    });
    document.addEventListener("DOMContentLoaded", () => {
        (async () => {
            const response = await fetch("https://dgrecipeapi.azurewebsites.net/api/User");
            const data = await response.json();
            const lst = document.getElementById("lstusers");
            data.forEach(u => {
                const option = document.createElement("option");
                option.value = u.usersId;
                option.text = u.usersName;
                lst.appendChild(option);
            });
        })();
    });
    frm.addEventListener("submit", (event) => {
        event.preventDefault();
        hmsg.innerHTML = "";
        const formdata = new FormData(frm);
        (async () => {
            try {
                const response = await fetch("https://dgrecipeapi.azurewebsites.net/api/Recipe/", {
                    method: "POST",
                    body: formdata
                });
                const data = await response.json();

                if (response.ok) {
                    txtrecipeid.value = data.recipeid;
                    hmsg.innerHTML = data.message;
                } else {
                    hmsg.innerHTML = data.Message || "Error saving recipe";
                }
            } catch (error) {
                console.error(error);
                hmsg.innerHTML = "An error occurred while saving the recipe.";
            }
        })();
    });

    document.getElementById("btndelete").addEventListener("click", (event) => {
        event.preventDefault();
        hmsg.innerHTML = "";
        const recipeId = txtrecipeid.value;

        if (recipeId === "0" || recipeId === "") {
            hmsg.innerHTML = "Please save the recipe first before deleting.";
            return;
        }
        (async () => {
            try {
                const response = await fetch(`https://dgrecipeapi.azurewebsites.net/api/Recipe?id=${recipeId}`, {
                    method: "DELETE"
                });
                const data = await response.json();

                if (response.ok) {
                    hmsg.innerHTML = data.message;
                    frm.reset();
                } else {
                    hmsg.innerHTML = data.Message || "Error deleting recipe";
                }
            } catch (error) {
                console.error(error);
                hmsg.innerHTML = "An error occurred while deleting the recipe.";
            }
        })();
    })
</script>